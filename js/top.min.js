/*!
 * Cirquity - Cirquity v0.1.0 (https://cirquity.com)
 * Copyright 2020-2020 The Cirquity Developers
 * Licensed under MIT (https://github.com/cirquity/cirquity-pool/blob/master/LICENSE)
 */

!function(t){let e=!1,a=!1,s={};t((function(){currentPage={destroy:function(){},update:function(e){a&&t.updateTop(e)}};let n=setInterval((function(){lastStats&&(t.topInitTemplate(s,e),t.loadTranslations(),clearInterval(n))}),10)})),t.updateTop=function(e){let a=e===parentCoin?api:mergedApis[e]?mergedApis[e].api:null;a&&t.topUpdateTop10(s,a,e)},t.topInitTemplate=function(s,n){let o=lastStats.config.coin;if(0===t(`#blocksTabs li:contains(${o})`).length){let e=t("#siblingTabTemplate").html();Mustache.parse(e);let a=Mustache.render(e,{coin:lastStats.config.coin,symbol:`(${lastStats.config.symbol})`,active:"active"});t("#blocksTabs").append(a),e=t("#siblingTemplate").html(),Mustache.parse(e),a=Mustache.render(e,{coin:o,active:"active"}),t("#blocksContent").append(a),t.topUpdateTop10(s,api,o)}Object.keys(mergedStats).forEach(e=>{if(0===t(`#blocksTabs li:contains(${e})`).length){o=e;let a=t("#siblingTabTemplate").html();Mustache.parse(a);let n=Mustache.render(a,{coin:mergedStats[e].config.coin,symbol:`(${mergedStats[e].config.symbol})`});t("#blocksTabs").append(n),a=t("#siblingTemplate").html(),Mustache.parse(a),n=Mustache.render(a,{coin:o}),t("#blocksContent").append(n),t.topUpdateTop10(s,mergedApis[e].api,e)}}),t.sortElementList(t("#blocksTabs"),t("#blocksTabs > li"),mergedStats),n||(e=t.topRunOnce()),a=!0},t.topUpdateTop10=function(e,a,s){e[s]&&e[s].abort(),e[s]=t.ajax({url:`${a}/get_top10miners`,data:{time:t(`#top10_rows${s}`).children().last().data("time")},dataType:"json",cache:"false",success:function(e){if(!e)return;let a=t(`#top10miners_rows${s}`);a.empty();for(let s=0;s<e.length;++s)a.append("<tr>"+t.topGetMinerCells(s+1,e[s])+"</tr>")}})},t.topGetMinerCells=function(e,a){let s=a.miner,n=a.hashrate?a.hashrate:0,o=a.lastShare?a.lastShare:0,i=(a.hashes||0).toString();return'<td data-sort="'+e+'">'+e+'</td><th data-sort="'+s+'">'+s+'</th><td class="text-right" data-sort="'+n+'">'+t.getReadableHashRateString(n)+'/sec</td><td class="text-right" data-sort="'+o+'">'+(o?t.timeago(new Date(1e3*parseInt(o)).toISOString()):"Never")+'</td><td class="text-right" data-sort="'+i+'">'+t.formatNumber(i,",")+"</td>"},t.topRunOnce=function(){return t("#blocksTabs a").click((function(e){e.preventDefault(),t(this).tab("show")})),!0}}(jQuery);