/*!
 * Cirquity - Cirquity v0.1.0 (https://cirquity.com)
 * Copyright 2020-2020 The Cirquity Developers
 * Licensed under MIT (https://github.com/cirquity/cirquity-pool/blob/master/LICENSE)
 */

!function(t){let e=!1;t((function(){currentPage={destroy:function(){},update:function(e){t.updateSettings(e)}};let i=setInterval((function(){lastStats&&(t.settingsInitTemplate(e),t.loadTranslations(),clearInterval(i))}),10)})),t.updateSettings=function(t){},t.settingsInitTemplate=function(i){lastStats.config.sendEmails||t(`#emailNotifications${lastStats.config.coin}`).hide();let n=lastStats.config.coin,s=t("#siblingTemplate").html();if(0===t(`#blocksTabs li:contains(${n})`).length){Mustache.parse(s);let e=Mustache.render(s,{coin:n,active:"active"});t("#blocksContent").append(e),s=t("#siblingTabTemplate").html(),Mustache.parse(s),e=Mustache.render(s,{coin:lastStats.config.coin,symbol:`(${lastStats.config.symbol})`,active:"active"}),t("#blocksTabs").append(e),t.settingsSetup(api,lastStats)}Object.keys(mergedStats).forEach(e=>{if(0===t(`#blocksTabs li:contains(${e})`).length){mergedStats[e].config.sendEmails||t(`#emailNotifications${mergedStats[e].config.coin}`).hide(),s=t("#siblingTemplate").html(),Mustache.parse(s);let i=Mustache.render(s,{coin:e});t("#blocksContent").append(i),s=t("#siblingTabTemplate").html(),Mustache.parse(s),i=Mustache.render(s,{coin:e,symbol:`(${mergedStats[e].config.symbol})`}),t("#blocksTabs").append(i),t.settingsSetup(mergedApis[e].api,mergedStats[e])}}),t.sortElementList(t("#blocksTabs"),t("#blocksTabs > li"),mergedStats),i||(e=t.settingsRunOnce())},t.settingsSetup=function(e,i){let n=t.getCurrentAddress(i.config.coin);n&&(t(`#yourAddress${i.config.coin}`).val(n),t.settingsGetPayoutLevel(e,n,i),t.settingsGetEmailAddress(e,n,i)),t(`#payoutSetButton${i.config.coin}`).click((function(){let n=t(`#yourAddress${i.config.coin}`).val().trim();if(!n||""===n)return void t.settingsShowError("noMinerAddress","No miner address specified","",i);let s=t(`#yourIP${i.config.coin}`).val().trim();if(!s||""===s)return void t.settingsShowError("noMinerIP","No miner IP address specified","",i);let a=t(`#yourPayoutRate${i.config.coin}`).val().trim();!a||a<0?t.settingsShowError("noPayoutLevel","No payout level specified","",i):t.settingsGetPayoutLevel(e,n,s,a,i)})),t(`#enableButton${i.config.coin}`).click((function(){let n=t(`#yourAddress${i.config.coin}`).val().trim(),s=t(`#yourIP${i.config.coin}`).val().trim(),a=t(`#yourEmail${i.config.coin}`).val();t.settingsSetEmailNotifications(i,e,a,n,s,!0)})),t(`#disableButton${i.config.coin}`).click((function(){let n=t(`#yourAddress${i.config.coin}`).val().trim(),s=t(`#yourIP${i.config.coin}`).val().trim(),a=t(`#yourEmail${i.config.coin}`).val();t.settingsSetEmailNotifications(i,e,a,n,s,!1)}))},t.settingsGetPayoutLevel=function(e,i,n){i&&""!==i&&t.ajax({url:`${e}/get_miner_payout_level`,data:{address:i},dataType:"json",cache:"false"}).done((function(e){void 0!==e.level&&t(`#yourPayoutRate${n.config.coin}`).val(e.level)}))},t.settingsGetEmailAddress=function(e,i,n){i&&""!==i&&t.ajax({url:`${e}/get_email_notifications`,data:{address:i},dataType:"json",cache:"false"}).done((function(e){void 0!==e.email&&t(`#yourEmail${n.config.coin}`).val(e.email)}))},t.settingsSetEmailNotifications=function(e,i,n,s,a,o){s&&""!==s?a&&""!==a?!o||n?!o||t.isEmail(n)?t.ajax({url:`${i}/set_email_notifications`,data:{address:s,ip:a,email:n,action:o?"enable":"disable"},dataType:"json",cache:"false"}).done((function(i){"done"===i.status?o?t.settingsShowSuccess("notificationEnabled","Done! Email notifications have been enabled",e):t.settingsShowSuccess("notificationDisabled","Done! Email notifications have been disabled",e):t.settingsShowError("error","Error:",i.status,e)})):t.settingsShowError("invalidEmail","Invalid email address specified",null,e):t.settingsShowError("noEmail","No email address specified",null,e):t.settingsShowError("noMinerIP","No miner IP address specified",null,e):t.settingsShowError("noMinerAddress","No miner address specified",null,e)},t.settingsShowSuccess=function(e,i,n){t.getTranslation(e)&&(i=t.getTranslation(e)),t(`#action_update_message${n.config.coin}`).text(i).removeClass().addClass("alert alert-success")},t.settingsShowError=function(e,i,n,s){t.getTranslation(e)&&(i=t.getTranslation(e)),i=i.trim(),n&&(i+=" "+n),t(`#action_update_message${s.config.coin}`).text(i).removeClass().addClass("alert alert-danger")},t.settingsRunOnce=function(){return t("#blocksTabs a").click((function(e){e.preventDefault(),t(this).tab("show")})),!0}}(jQuery);