/*!
 * Cirquity - Cirquity v0.1.0 (https://cirquity.com)
 * Copyright 2020-2020 The Cirquity Developers
 * Licensed under MIT (https://github.com/cirquity/cirquity-pool/blob/master/LICENSE)
 */

!function(t){let e=!1,a={},s={},c={},n={},r={},i={},l="cryptonator",o="USD";t((function(){currentPage={destroy:function(){},update:function(e){t.updateSettings(e)}};let l=setInterval((function(){lastStats&&(t.marketInitTemplate(e,a,s,r,c,i,n),t.loadTranslations(),clearInterval(l))}),10);if("undefined"!=typeof cryptonatorWidget&&"undefined"==typeof marketCurrencies){cryptonatorWidget}})),t.updateSettings=function(t){},t.marketInitTemplate=function(a,s,c,n,r,i,u){l=lastStats.config.priceSource||l,o=lastStats.config.priceCurrency||o;let d=lastStats.config.coin;if(0===t(`#blocksTabs li:contains(${d})`).length){s[d]=!1,c[d]=!1,n[d]={};let e=t("#siblingTabTemplate").html();Mustache.parse(e);let a=Mustache.render(e,{coin:lastStats.config.coin,symbol:`(${lastStats.config.symbol})`,active:"active"});t("#blocksTabs").append(a);let i=t("#siblingMarketTemplate").html();Mustache.parse(i);let l=Mustache.render(i,{coin:d,active:"active"});t("#blocksContent").append(l);let u=t("#siblingCalculatorTemplate").html();Mustache.parse(u);let p=Mustache.render(u,{coin:d});t("#calculatorInner").append(p),t.updateText(`priceChartCurrency${lastStats.config.coin}`,o),t.updateText(`profitChartProfit${lastStats.config.coin}`,o),lastStats.charts&&!s[d]&&(r[d]=setInterval(t.marketCreateCharts(lastStats),6e4),t.marketCreateCharts(lastStats),s[d]=!0)}t.marketLoadData(api,lastStats,c,i,u,n),Object.keys(mergedStats).forEach(e=>{if(0===t(`#blocksTabs li:contains(${e})`).length){s[e]=!1,c[e]=!1,n[e]={};let a=t("#siblingMarketTemplate").html();Mustache.parse(a);let r=Mustache.render(a,{coin:e});t("#blocksContent").append(r);let i=t("#siblingTabTemplate").html();Mustache.parse(i);let l=Mustache.render(i,{coin:e,symbol:`(${mergedStats[e].config.symbol})`});t("#blocksTabs").append(l)}t.updateText(`priceChartCurrency${mergedStats[e].config.coin}`,o),t.updateText(`profitChartProfit${mergedStats[e].config.coin}`,o),t.marketLoadData(mergedApis[e].api,mergedStats[e],c,i,u,n),mergedStats[e].charts&&!s[e]&&(r[e]=setInterval(t.marketCreateCharts(mergedStats[e]),6e4),t.marketCreateCharts(mergedStats[e]),s[e]=!0)}),t.marketCalcEstimateProfit(n),t.sortElementList(t("#blocksTabs"),t("#blocksTabs > li"),mergedStats),a||(e=t.marketRunOnce())},t.marketCalcEstimateProfit=function(e){let a=Math.pow(1e3,parseInt(t("#calcHashUnit").data("mul"))),s=parseFloat(t("#calcHashRate").val())*a,c=lastStats.config.coin;try{if(0===t(`#calcHashAmount${c}`).length){let e=t("#calcHashResultTemplate").html();Mustache.parse(e);let a=Mustache.render(e,{coin:c});t(a).insertAfter("#calcHashHolder")}let a=86400*s/lastStats.network.difficulty*lastStats.lastblock.reward;a?(t.updateText(`calcHashAmount${c}1`,t.getReadableCoin(lastStats,a)),t.updateText(`calcHashAmount${c}2`,t.marketGetCurrencyPriceText(lastStats,a,e))):(t.updateText(`calcHashAmount${c}1`,""),t.updateText(`calcHashAmount${c}2`,""))}catch(e){t.updateText(`calcHashAmount${c}1`,""),t.updateText(`calcHashAmount${c}2`,"")}Object.keys(mergedStats).forEach(a=>{try{if(0===t(`#calcHashAmount${a}`).length){let e=t("#calcHashResultTemplate").html();Mustache.parse(e);let s=Mustache.render(e,{coin:a});t(s).insertAfter("#calcHashHolder")}let c=86400*s/mergedStats[a].network.difficulty*mergedStats[a].lastblock.reward;c?(t.updateText(`calcHashAmount${a}1`,t.getReadableCoin(mergedStats[a],c)),t.updateText(`calcHashAmount${a}2`,t.marketGetCurrencyPriceText(mergedStats[a],c,e))):(t.updateText(`calcHashAmount${a}1`,""),t.updateText(`calcHashAmount${a}2`,""))}catch(e){t.updateText(`calcHashAmount${a}1`,""),t.updateText(`calcHashAmount${a}2`,"")}})},t.marketGetCurrencyPriceText=function(e,a,s){if(!o||!s[e.config.coin]||!s[e.config.coin][o])return;return Math.trunc(t.getReadableCoin(e,a,2,!0,!0)*s[e.config.coin][o]*100)/100+" "+o},t.marketLoadData=function(e,a,s,c,n,r){s[a.config.coin]||("undefined"!=typeof marketCurrencies&&marketCurrencies.length>0?setInterval(t.marketUpdate(e,a,c,n,r),3e5):t(`#marketInfos${a.config.coin}`).hide(),s[a.config.coin]=!0)},t.marketUpdate=function(e,a,s,c,n){let r=t(`#marketInfos${a.config.coin}`);if("undefined"!=typeof marketCurrencies&&0!==marketCurrencies.length){s[a.config.coin]=[];for(let t=0;t<marketCurrencies.length;t++)s[a.config.coin].push(marketCurrencies[t].replace("{symbol}",a.config.symbol).toUpperCase());c[a.config.coin]&&c[a.config.coin].abort(),c[a.config.coin]=t.ajax({url:e+"/get_market",data:{tickers:s[a.config.coin]},dataType:"json",cache:"false",success:function(e){if(e&&0!==e.length){r.empty();for(let s in e){if(!e[s]||!e[s].ticker)continue;let c=e[s].ticker.split("-"),r=c[0]||null,i=c[1]||null,l=e[s].price;if(!l||0===l)continue;let o=e[s].source;t.marketRenderPrice(r,i,l,o,a,n)}r.show()}else t(`#marketInfos${a.config.coin}`).hide()},error:function(){r.hide()}})}},t.marketRenderPrice=function(e,a,s,c,n,r){let i='<i class="far fa-money-bill-alt"></i>';"BTC"===a&&(i='<i class="fab fa-btc"></i>'),"BCH"===a&&(i='<i class="fab fa-btc"></i>'),"USD"===a&&(i='<i class="fas fa-dollar-sign"></i>'),"CAD"===a&&(i='<i class="fas fa-dollar-sign"></i>'),"EUR"===a&&(i='<i class="fas fa-euro-sign"></i>'),e===n.config.symbol.toUpperCase()&&(r[n.config.coin][a]=s),s="USD"===a||"CAD"===a||"EUR"===a||"GBP"===a||"JPY"===a?s.toFixed(4):s.toFixed(8);let l=null;"cryptonator"===c?l="https://www.cryptonator.com/":"altex"===c?l="https://altex.exchange/":"crex24"===c?l="https://crex24.com/":"cryptopia"===c?l="https://www.cryptopia.co.nz/":"stocks.exchange"===c?l="https://stocks.exchange/":"tradeogre"===c?l="https://tradeogre.com/":"coingecko"===c&&(l="https://coingecko.com/"),c=c.charAt(0).toUpperCase()+c.slice(1),l&&(c='<a href="'+l+'" target="_blank" rel="nofollow">'+c+"</a>"),t(`#marketInfos${n.config.coin}`).append('<div class="col-4 mb-4">    <div class="card shadow-light">        <div class="card-body">            <div class="list-group list-group-flush">                <div class="list-group-item d-flex align-items-center">                    <div class="mr-auto">                        <span class="icon">'+i+'</span>                        <h5 class="font-weight-bold mb-1">'+e+" to "+a+'</h5>                        <p class="font-size-sm text-muted mb-0">'+s+'</p>                        <small class="font-size-sm text-muted mb-0">Source: '+c+"</small>                    </div>                </div>            </div>        </div>    </div></div>")},t.marketCreateCharts=function(e){if(!e||!e.charts)return;let a=e.charts,s={price:t.marketGetGraphData(a.price),profit:t.marketGetGraphData(a.profit)};for(let a in s)if(s[a].values.length>1){let c=t(`#chart${e.config.coin}_${a}`),n=null,r=null,i=null,l=c.siblings("a.chart-style");1===l.length&&(n=l.css("background-color"),r=l.css("border-left-color"),i=parseFloat(l.css("width")));new Chart(document.getElementById(`chart${e.config.coin}_${a}`),{type:"line",data:{labels:s[a].names,datasets:[{data:s[a].values,dataType:a,fill:!0,backgroundColor:"rgba(3, 169, 244, .4)",borderColor:"#03a9f4",borderWidth:2}]},options:{animation:!1,responsive:!0,maintainAspectRatio:!1,legend:{display:!1},elements:{point:{radius:0,hitRadius:10,hoverRadius:5}},scales:{xAxes:[{display:!1,ticks:{display:!1},gridLines:{display:!1}}],yAxes:[{display:!1,ticks:{display:!1,beginAtZero:!0,userCallback:function(t,e,a){if(Math.floor(t)===t)return t}},gridLines:{display:!1}}]},layout:{padding:{top:5,left:10,right:10,bottom:10}},tooltips:{callbacks:{label:function(t,e){let a=e.datasets[t.datasetIndex].dataType||"",s=t.yLabel;return"price"===a?s=parseFloat(t.yLabel).toFixed(4):"profit"===a&&(s=parseFloat(t.yLabel).toFixed(10))," "+s}}}}});c.closest(".marketChart").show()}},t.marketGetGraphData=function(t){let e={names:[],values:[]};if(t)for(let a,s=0;a=t[s];s++)e.names.push(new Date(1e3*a[0]).toLocaleString()),e.values.push(a[1]);return e},t.marketRunOnce=function(){return t("#calcHashRate").keyup(e=>{t.marketCalcEstimateProfit(r)}).change(e=>{t.marketCalcEstimateProfit(r)}),t("#calcHashUnits > a").click((function(e){e.preventDefault(),t("#calcHashUnit").text(t(this).text()).data("mul",t(this).data("mul")),t.marketCalcEstimateProfit(r)})),t("#blocksTabs a").click((function(e){e.preventDefault(),t(this).tab("show")})),!0}}(jQuery);