/*!
 * Cirquity - Cirquity v0.1.0 (https://cirquity.com)
 * Copyright 2020-2020 The Cirquity Developers
 * Licensed under MIT (https://github.com/cirquity/cirquity-pool/blob/master/LICENSE)
 */

!function(t){let e=!1,a=!1,n={};t((function(){currentPage={destroy:function(){},update:function(e){a&&t.updatePayments(e)}};let s=setInterval((function(){lastStats&&(t.paymentsInitTemplate(n,e),t.loadTranslations(),clearInterval(s))}),10)})),t.updatePayments=function(e){let a=e===parentCoin?lastStats:mergedStats[e];a&&(t.updateText(`paymentsTotal${e}`,a.pool.totalPayments.toString()),t.updateText(`paymentsTotalPaid${e}`,a.pool.totalMinersPaid.toString()),t.updateText(`paymentsInterval${e}`,t.getReadableTime(a.config.paymentsInterval)),t.updateText(`paymentsMinimum${e}`,t.getReadableCoin(a,a.config.minPaymentThreshold)),t.updateText(`paymentsDenomination${e}`,t.getReadableCoin(a,a.config.denominationUnit,3)),t.paymentsRenderPayments(a.pool.payments,a))},t.paymentsInitTemplate=function(n,s){let i=lastStats.config.coin;if(0===t(`#blocksTabs li:contains(${i})`).length){let e=t("#siblingTemplate").html();Mustache.parse(e);let a=Mustache.render(e,{coin:i,active:"active"});t("#blocksContent").append(a);let s=t("#siblingTabTemplate").html();Mustache.parse(s);let o=Mustache.render(s,{coin:lastStats.config.coin,symbol:`(${lastStats.config.symbol})`,active:"active"});t("#blocksTabs").append(o),t.paymentsSetup(n,api,lastStats)}t.updateText(`paymentsTotal${i}`,lastStats.pool.totalPayments.toString()),t.updateText(`paymentsTotalPaid${i}`,lastStats.pool.totalMinersPaid.toString()),t.updateText(`paymentsInterval${i}`,t.getReadableTime(lastStats.config.paymentsInterval)),t.updateText(`paymentsMinimum${i}`,t.getReadableCoin(lastStats,lastStats.config.minPaymentThreshold)),t.updateText(`paymentsDenomination${i}`,t.getReadableCoin(lastStats,lastStats.config.denominationUnit,3)),t.paymentsRenderPayments(lastStats.pool.payments,lastStats),Object.keys(mergedStats).forEach(e=>{if(0===t(`#blocksTabs li:contains(${e})`).length){let a=t("#siblingTemplate").html();Mustache.parse(a);let s=Mustache.render(a,{coin:e});t("#blocksContent").append(s);let i=t("#siblingTabTemplate").html();Mustache.parse(i);let o=Mustache.render(i,{coin:e,symbol:`(${mergedStats[e].config.symbol})`});t("#blocksTabs").append(o),t.paymentsSetup(n,mergedApis[e].api,mergedStats[e])}t.updateText(`paymentsTotal${e}`,mergedStats[e].pool.totalPayments.toString()),t.updateText(`paymentsTotalPaid${e}`,mergedStats[e].pool.totalMinersPaid.toString()),t.updateText(`paymentsInterval${e}`,t.getReadableTime(mergedStats[e].config.paymentsInterval)),t.updateText(`paymentsMinimum${e}`,t.getReadableCoin(mergedStats[e],mergedStats[e].config.minPaymentThreshold)),t.updateText(`paymentsDenomination${e}`,t.getReadableCoin(mergedStats[e],mergedStats[e].config.denominationUnit,3)),t.paymentsRenderPayments(mergedStats[e].pool.payments,mergedStats[e])}),t.sortElementList(t("#blocksTabs"),t("#blocksTabs > li"),mergedStats),s||(e=t.paymentRunOnce()),a=!0},t.paymentsRenderPayments=function(e,a){let n=t(`#paymentsReport${a.config.coin}_rows`);for(let s=0;s<e.length;s+=2){let i=t.paymentsParsePayment(e[s+1],e[s]),o=JSON.stringify(i),l=document.getElementById(`paymentRow${a.config.coin}${i.time}`);if(l&&l.getAttribute("data-json")!==o)t(l).replaceWith(t.paymentsGetPaymentRowElement(i,o,a));else if(!l){let e=t.paymentsGetPaymentRowElement(i,o,a),s=!1,l=n.children().get();for(let a=0;a<l.length;a++){if(parseInt(l[a].getAttribute("data-time"))<i.time){s=!0,t(l[a]).before(e);break}}s||n.append(e)}}},t.paymentsParsePayment=function(t,e){let a=e.split(":");return{time:parseInt(t),hash:a[0],amount:a[1],fee:a[2],mixin:a[3],recipients:a[4]}},t.paymentsGetPaymentRowElement=function(e,a,n){let s=document.createElement("tr");return s.setAttribute("data-json",a),s.setAttribute("data-time",e.time),s.setAttribute("id",`paymentRow${n.config.coin}${e.time}`),s.innerHTML=t.paymentsGetPaymentCells(e,n),s},t.paymentsGetPaymentCells=function(e,a){return'<td class="col1">'+t.timeago(new Date(1e3*parseInt(e.time)).toISOString())+'</td><th class="col2">'+t.formatPaymentLink(e.hash,a)+'</th><td class="col3">'+t.getReadableCoin(a,e.amount)+'</td><td class="col4">'+t.getReadableCoin(a,e.fee)+'</td><td class="col5">'+e.mixin+'</td><td class="col6">'+e.recipients+"</td>"},t.paymentsSetup=function(e,a,n){t(`#loadMorePayments${n.config.coin}`).click((function(){e[n.config.coin]&&e[n.config.coin].abort(),e[n.config.coin]=t.ajax({url:a+"/get_payments",data:{time:t(`#paymentsReport${n.config.coin}_rows`).children().last().data("time")},dataType:"json",cache:"false",success:function(e){t.paymentsRenderPayments(e,n)}})}))},t.paymentRunOnce=function(){return t("#blocksTabs a").click((function(e){e.preventDefault(),t(this).tab("show")})),!0}}(jQuery);