/*!
 * Cirquity - Cirquity v0.1.0 (https://cirquity.com)
 * Copyright 2020-2020 The Cirquity Developers
 * Licensed under MIT (https://github.com/cirquity/cirquity-pool/blob/master/LICENSE)
 */

!function(t){let e=!1,a=!1,o={},n={},s={type:"line",width:"100%",height:"140",lineColor:"#03a9f4",fillColor:"rgba(3, 169, 244, .4)",spotColor:null,minSpotColor:null,maxSpotColor:null,highlightLineColor:"#236d26",spotRadius:3,chartRangeMin:0,drawNormalOnTop:!1,tooltipFormat:"<b>{{y}}</b> &ndash; {{offset:names}}"};t((function(){currentPage={destroy:function(){},update:function(e){a&&t.updateStats(e)}};let s=setInterval((function(){lastStats&&(t.statsInitTemplate(e,n,o),t.loadTranslations(),clearInterval(s))}),10)})),t.updateStats=function(t){},t.statsInitTemplate=function(o,n,s,i){let r=lastStats.config.coin;if(0===t(`#blocksTabs li:contains(${r})`).length){let e=t("#siblingTabTemplate").html();Mustache.parse(e);let a=Mustache.render(e,{coin:lastStats.config.coin,symbol:`(${lastStats.config.symbol})`,active:"active"});t("#blocksTabs").append(a),e=t("#siblingTemplate").html(),Mustache.parse(e),a=Mustache.render(e,{coin:r,active:"active"}),t("#blocksContent").append(a),t.statsSetup(lastStats,api,n,s,i)}Object.keys(mergedStats).forEach(e=>{if(0===t(`#blocksTabs li:contains(${e})`).length){r=e;let a=t("#siblingTabTemplate").html();Mustache.parse(a);let o=Mustache.render(a,{coin:mergedStats[e].config.coin,symbol:`(${mergedStats[e].config.symbol})`});t("#blocksTabs").append(o),a=t("#siblingTemplate").html(),Mustache.parse(a),o=Mustache.render(a,{coin:r}),t("#blocksContent").append(o),t.statsSetup(mergedStats[e],mergedApis[e].api,n,s,i)}}),t.sortElementList(t("#blocksTabs"),t("#blocksTabs > li"),mergedStats),o||(e=t.statsRunOnce()),a=!0},t.statsSetup=function(e,a,o,n,s){t(`#yourLastShare${e.config.coin}`).timeago(),t(`#lookUp${e.config.coin}`).click((function(){let s=t(`#yourStatsInput${e.config.coin}`).val().trim();if(t.getCurrentAddress(e.config.coin)!==s){if(docCookies.setItem(`mining_address_${e.config.coin}`,s,1/0),location.search.split("walletMerged=")[1]||0)return void(window.location.href="/#worker_stats");docCookies.setItem(`mining_address_${e.config.coin}`,s,1/0),t.loadLiveStats(!0,mergedStats)}t(`#addressError${e.config.coin}, .yourStats${e.config.coin}, .yourWorkers${e.config.coin}, .userChart${e.config.coin}`).hide(),t(`#workersReport_rows_${e.config.coin}`).empty(),t(`#paymentsReport_rows_${e.config.coin}`).empty(),t(`#lookUp${e.config.coin} > span:first-child`).hide(),t(`#lookUp${e.config.coin} > span:last-child`).show(),o[e.config.coin]&&clearTimeout(o[e.config.coin]),n[e.config.coin]&&n[e.config.coin].abort(),t(`#lookUp${e.config.coin} > span:last-child`).hide(),t(`#lookUp${e.config.coin} > span:first-child`).show(),s?t.statsFetchAddressStats(!1,e,a,n):t(`#yourStatsInput${e.config.coin}`).focus()}));let i=t.getCurrentAddress(e.config.coin);i?(t(`#yourStatsInput${e.config.coin}`).val(i),t(`#lookUp${e.config.coin}`).click()):(t(`#lookUp${e.config.coin} > span:last-child`).hide(),t(`#lookUp${e.config.coin} > span:first-child`).show(),t(`#addressError${e.config.coin}, .yourStats${e.config.coin}, .yourWorkers${e.config.coin}, .userChart${e.config.coin}`).hide()),t("#yourStatsInput"+e.config.coin).keyup((function(a){13===a.keyCode&&t(`#lookUp${e.config.coin}`).click()})),t(`#loadMorePayments${e.config.coin}`).click((function(o){o[e.config.coin]&&o[e.config.coin].abort(),o[e.config.coin]=t.ajax({url:`${a}/get_payments`,data:{time:t(`#paymentsReport_rows_${e.config.coin}`).children().last().data("time"),address:i},dataType:"json",cache:"false",success:function(a){t.statsRenderPayments(a,e)}})}))},t.statsRenderPayments=function(e,a){let o=t(`#paymentsReport_rows_${a.config.coin}`),n=null,s={date:null,time:null,count:0,amount:0};for(let i=0;i<e.length;i+=2){let r=t.statsParsePayment(e[i+1],e[i]),c=JSON.stringify(r),l=t.statsGetPaymentRowElement(r,c,a),d=new Date(1e3*parseInt(r.time)).toLocaleDateString();(!n||n&&d!==n)&&(s={date:d,time:r.time,count:0,amount:0});let u=document.getElementById(`paymentRow${a.config.coin}${r.time}`);if(u&&u.getAttribute("data-json")!==c)t(u).replaceWith(t.statsGetPaymentRowElement(r,c,a));else if(!u){let e=!1,a=o.children().get();for(let o=0;o<a.length;o++){let n=parseInt(a[o].getAttribute("data-time"));if(n&&n<r.time){e=!0,t(a[o]).before(l);break}}e||o.append(l)}s.count++,s.amount+=parseInt(r.amount);let g=JSON.stringify(s),f=t.statsGetSummaryRowElement(s,g,a),m=document.getElementById(`summaryRow${a.config.coin}${s.date}`);if(m&&m.getAttribute("data-json")!==g)t(m).replaceWith(f);else if(!m){let e=!1,a=o.children().get();for(let o=0;o<a.length;o++){let n=parseInt(a[o].getAttribute("data-time"));if(n&&n===s.time){e=!0,t(a[o]).before(f);break}}e||o.append(f)}n=d}},t.statsFetchAddressStats=function(e,a,o,s){let i=t.getCurrentAddress(a.config.coin);s[a.config.coin]=t.ajax({url:`${o}/stats_address`,data:{address:i,longpoll:e},dataType:"json",cache:"false",success:function(e){if(!e.stats)return t(`.yourStats${a.config.coin}, .yourWorkers${a.config.coin}, .userChart${a.config.coin}`).hide(),t(`#addressError${a.config.coin}`).text(e.error).show(),docCookies.setItem(`mining_address_${a.config.coin}`,"",1/0),void loadLiveStats(!0);t(`#addressError${a.config.coin}`).hide(),e.stats.lastShare?t(`#yourLastShare${a.config.coin}`).timeago("update",new Date(1e3*parseInt(e.stats.lastShare)).toISOString()):t.updateText(`yourLastShare${a.config.coin}`,"Never"),t.updateText(`yourHashrateHolder${a.config.coin}`,(t.getReadableHashRateString(e.stats.hashrate)||"0 H")+"/sec"),"hashrate_1h"in e.stats?(t(`#minerAvgHR${a.config.coin}`).show(),t.updateText(`yourHR1h${a.config.coin}`,(t.getReadableHashRateString(e.stats.hashrate_1h)||"0 H")+"/s"),t.updateText(`yourHR6h${a.config.coin}`,(t.getReadableHashRateString(e.stats.hashrate_6h)||"0 H")+"/s"),t.updateText(`yourHR24h${a.config.coin}`,(t.getReadableHashRateString(e.stats.hashrate_24h)||"0 H")+"/s")):t(`#minerAvgHR${a.config.coin}`).hide();let o=e.stats.paid,n=0,s=0;for(let a=0;a<e.payments.length;a+=2){let o=t.statsParsePayment(e.payments[a+1],e.payments[a]),i=new Date(1e3*parseInt(o.time)),r=moment().diff(moment(i),"days");r<1&&(n+=parseInt(o.amount)),r<7&&(s+=parseInt(o.amount))}t.updateText(`yourPaid${a.config.coin}`,t.getReadableCoin(a,o)),t.updateText(`paid24h${a.config.coin}`,t.getReadableCoin(a,n)),t.updateText(`paid7d${a.config.coin}`,t.getReadableCoin(a,s)),t.updateText(`yourHashes${a.config.coin}`,t.formatNumber((e.stats.hashes||0).toString(),",")),t.updateText(`yourPendingBalance${a.config.coin}`,t.getReadableCoin(a,e.stats.balance));let i=parseInt(e.stats.roundHashes||0),r=parseInt(a.pool.roundHashes||0),c=parseFloat(e.stats.roundScore||0),l=parseFloat(a.pool.roundScore||0),d=parseFloat(a.lastblock.reward||0),u=a.config.fee;if(Object.keys(a.config.donation).length){let t=0,e=a.config.donation;for(let a in e)t+=e[a];u+=t}let g=a.config.transferFee,f=100*i/r,m=100*c/l;t.updateText(`yourRoundShareProportion${a.config.coin}`,isNaN(f)?0:Math.round(1e3*f)/1e3),t.updateText(`yourRoundScoreProportion${a.config.coin}`,isNaN(m)?0:Math.round(1e3*m)/1e3),lastStats.config.slushMiningEnabled||t(`#slush_round_info${a.config.coin}`).hide();let h=parseFloat(100*i/r),p=Math.round(d*(h/100));g&&(p-=g),p<0&&(p=0),t.updateText(`yourPayoutEstimate${a.config.coin}`,t.getReadableCoin(a,p)),t.statsRenderPayments(e.payments,a),e.workers&&e.workers.length>0&&(t.statsRenderWorkers(e.workers,a),t(`.yourWorkers${a.config.coin}`).show()),t(`.yourStats${a.config.coin}`).show(),t.statsCreateCharts(e,a)},error:function(e){"abort"!==e.statusText&&(t(`#addressError${a.config.coin}`).text("Connection error").show(),n[a.config.coin]&&clearTimeout(n[a.config.coin]),n[a.config.coin]=setTimeout((function(){t.statsFetchAddressStats(!1,a,mergedApis[a.config.coin].api)}),2e3))}})},t.statsParsePayment=function(t,e){let a=e.split(":");return{time:parseInt(t),hash:a[0],amount:a[1],fee:a[2],mixin:a[3],recipients:a[4]}},t.statsGetPaymentRowElement=function(e,a,o){let n=document.createElement("tr");return n.setAttribute("data-json",a),n.setAttribute("data-time",e.time),n.setAttribute("id","paymentRow"+o.config.coin+e.time),n.innerHTML=t.statsGetPaymentCells(e,o),n},t.statsGetPaymentCells=function(e,a){return'<td class="col1">'+t.formatDate(e.time)+'</td><th class="col2">'+t.formatPaymentLink(e.hash,a)+'</th><td class="col3">'+t.getReadableCoin(a,e.amount)+'</td><td class="col4">'+e.mixin+"</td>"},t.statsGetSummaryRowElement=function(e,a,o){let n=document.createElement("tr");return n.setAttribute("data-json",a),n.setAttribute("data-date",e.date),n.setAttribute("id","summaryRow"+o.config.coin+e.date),n.setAttribute("class","summary"),n.innerHTML=t.statsGetSummaryCells(e,o),n},t.statsGetSummaryCells=function(e,a){let o=t.getTranslation("paymentSummaryMulti")?t.getTranslation("paymentSummaryMulti"):"On %DATE% you have received %AMOUNT% in %COUNT% payments";return e.count<=1&&(o=t.getTranslation("paymentSummarySingle")?t.getTranslation("paymentSummarySingle"):"On %DATE% you have received %AMOUNT%"),o=o.replace(/%DATE%/g,e.date),o=o.replace(/%COUNT%/g,e.count),o=o.replace(/%AMOUNT%/g,t.getReadableCoin(a,e.amount)),'<td colspan="4">'+o+"</td>"},t.statsRenderWorkers=function(e,a){e=e.sort(t.statsSortWorkers);let o=t(`#workersReport_rows_${a.config.coin}`);for(let n=0;n<e.length;n++){if(!document.getElementById(`workerRow${a.config.coin}_${t.statsGetWorkerRowId(e[n].name)}`)){o.empty();break}}let n=!1;for(let s=0;s<e.length;s++){let i=e[s];if(Date.now()/1e3-parseInt(i.lastShare)>172800)continue;!n&&"hashrate_1h"in i&&(n=!0);let r=JSON.stringify(i),c=document.getElementById(`workerRow${a.config.coin}_${t.statsGetWorkerRowId(i.name)}`);if(c&&c.getAttribute("data-json")!==r)t(c).replaceWith(t.statsGetWorkerRowElement(i,r,a));else if(!c){let e=t.statsGetWorkerRowElement(i,r,a);o.append(e)}}n?t(`#workersReport${a.config.coin} .avghr`).show():t(`#workersReport${a.config.coin} .avghr`).hide()},t.statsGetWorkerRowElement=function(e,a,o){let n=document.createElement("tr");return n.setAttribute("data-json",a),n.setAttribute("data-name",e.name),n.setAttribute("id","workerRow"+o.config.coin+"_"+t.statsGetWorkerRowId(e.name)),n.innerHTML=t.statsGetWorkerCells(e),n},t.statsGetWorkerCells=function(e){let a=e.hashrate?e.hashrate:0,o=e.hashrate_1h||0,n=e.hashrate_6h||0,s=e.hashrate_24h||0,i=e.lastShare?e.lastShare:0,r=(e.hashes||0).toString(),c=a<=0?"error":"ok";return'<td class="col1" data-sort="'+c+'"><i class="fa fa-'+("ok"===c?"check status-ok":"times status-error")+'"></i></td><td class="col2" data-sort="'+("undefined"!==e.name?e.name:"")+'">'+("undefined"!==e.name?e.name:"<em>Undefined</em>")+'</td><td class="col3" data-sort="'+a+'">'+t.getReadableHashRateString(a)+'/s</td><td class="col4 avghr" data-sort="'+o+'">'+t.getReadableHashRateString(o)+'/s</td><td class="col5 avghr" data-sort="'+n+'">'+t.getReadableHashRateString(n)+'/s</td><td class="col6 avghr" data-sort="'+s+'">'+t.getReadableHashRateString(s)+'/s</td><td class="col4" data-sort="'+i+'">'+(i?t.timeago(new Date(1e3*parseInt(i)).toISOString()):"Never")+'</td><td class="col5" data-sort="'+r+'">'+r+"</td>"},t.statsSortWorkers=function(t,e){let a=t.name.toLowerCase(),o=e.name.toLowerCase();return a<o?-1:a>o?1:0},t.statsGetWorkerRowId=function(t){let e=btoa(t);return e=e.replace(/=/,""),e},t.statsCreateCharts=function(e,a){if(e.hasOwnProperty("charts")){let o={hashrate:t.statsGetGraphData(a,e.charts.hashrate),payments:t.statsGetGraphData(a,e.charts.payments,!0)};for(let e in o)if(o[e].values.length>1){let n=jQuery.extend({},s);n.tooltipValueLookups={names:o[e].names},t(`[data-chart=user_${e}_${a.config.coin}]`).show().find(".chart").sparkline(o[e].values,n)}}},t.statsGetGraphData=function(e,a,o){let n={names:[],values:[]};if(a)for(let s,i=0;s=a[i];i++)n.names.push(new Date(1e3*s[0]).toLocaleString()),n.values.push(o?t.getReadableCoin(e,s[1],null,!0,!0):s[1]);return n},t.statsRunOnce=function(){return t("#blocksTabs a").click((function(e){e.preventDefault(),t(this).tab("show");let a=t(this).data("coin");t(`#lookUp${a}`).click()})),!0}}(jQuery);