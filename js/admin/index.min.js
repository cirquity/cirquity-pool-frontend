/*!
 * Cirquity - Cirquity v0.1.0 (https://cirquity.com)
 * Copyright 2020-2020 The Cirquity Developers
 * Licensed under MIT (https://github.com/cirquity/cirquity-pool/blob/master/LICENSE)
 */

!function(t){t((function(){currentPage={destroy:function(){},update:function(t){}};let e=setInterval((function(){lastStats&&(t.getStats(),t.createPortsTable(),t.loadTranslations(),clearInterval(e))}),10);t("#testEmailButton").click((function(){let e=docCookies.getItem("password");e||(e=prompt("Enter admin password"));let s=t("#emailAddress").val().trim();s?t.isEmailTest(s)?t.ajax({url:api+"/test_email_notification",data:{password:e,email:s},dataType:"json",cache:"false"}).done((function(s){docCookies.setItem("password",e,1/0),"done"===s.status?t.showSuccessTest("email","Done! Test is successful."):t.showErrorTest("email","Error: "+s.status)})):t.showErrorTest("invalidEmail","Invalid email address specified"):t.showErrorTest("email","No email address specified")})),t("#testTelegramButton").click((function(){let e=docCookies.getItem("password");e||(e=prompt("Enter admin password")),t.ajax({url:api+"/test_telegram_notification",data:{password:e},dataType:"json",cache:"false"}).done((function(s){docCookies.setItem("password",e,1/0),"done"===s.status?t.showSuccessTest("telegram","Test done! Check pool logs for more debugging information."):t.showErrorTest("telegram","Error: "+s.status)}))}))})),t.formatLuckStats=function(t,e){let s=Math.round(e/t*100);return s?s<=100?'<span class="text-success">'+s+"%</span>":s>=101&&s<=150?'<span class="text-info">'+s+"%</span>":'<span class="text-danger">'+s+"%</span>":'<span class="text-success">?</span>'},t.getStats=function(e){let s=docCookies.getItem("password");s&&!e||(s=prompt("Enter admin password")),t("#loading").show(),t.ajax({url:api+"/admin_stats",data:{password:s},dataType:"json",cache:"false",success:function(e){docCookies.setItem("password",s,1/0),t("#loading").hide(),t.renderData(e)},error:function(e){docCookies.removeItem("password"),t.getStats(!0)}})},t.renderData=function(e){t("#totalOwed").text(t.getReadableCoin(lastStats,e.totalOwed)),t("#totalPaid").text(t.getReadableCoin(lastStats,e.totalPaid)),t("#totalMined").text(t.getReadableCoin(lastStats,e.totalRevenue+e.totalRevenueSolo)),t("#profit").text(t.getReadableCoin(lastStats,e.totalRevenue+e.totalRevenueSolo-e.totalOwed-e.totalPaid)),t("#blocksUnlocked").text(e.blocksUnlocked),t("#averageLuck").html(t.formatLuckStats(e.totalDiff,e.totalShares)),t("#blocksOrphaned").text(e.blocksOrphaned),t("#orphanPercent").text((e.blocksOrphaned/e.blocksUnlocked*100).toFixed(2)+"%"),t("#registeredAddresses").text(e.totalWorkers)},t.parsePorts=function(e){let s=0,a=[],o={};for(let t in e)if(e.hasOwnProperty(t)){let o=e[t],r=o.users?parseInt(o.users):0;r>0&&(a.push({port:o.port,users:r}),s+=r)}return t("#totalUsers").html(s),o.ports=a.sort((function(t,e){return t.port.port-e.port.port})).reverse(),o},t.createPortsTable=function(e){let s=docCookies.getItem("password");s&&!e||(s=prompt("Enter admin password")),t.ajax({url:api+"/admin_ports",data:{password:s},cache:!1,dataType:"json",success:function(e){docCookies.setItem("password",s,1/0),t.renderAdminTemplate(t.parsePorts(e),"#portsListTable","#template")},error:function(t){docCookies.removeItem("password")}})},t.showErrorTest=function(e,s){t("#test_"+e+"_message").text(s).removeClass().addClass("alert alert-danger mt-5")},t.showSuccessTest=function(e,s){t("#test_"+e+"_message").text(s).removeClass().addClass("alert alert-success mt-5")},t.isEmailTest=function(t){return/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(t)}}(jQuery);